<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<head>
		<div th:replace="fragments/fragments :: head">
		</div>
	</head>
</head>

<body>
	<header>
			<div th:replace="fragments/fragments :: header">
			</div>
		</header>
	
	<main>
	<section>
		<div class="container mt-2">
			<div class="row">
				<div class=" col-lg-12 mt-1">
					<div class="col-12 mb-2	d-flex justify-content-center">
						<h1>Ticket</h1>
					</div>
					<div class="col-12" th:if="${ticket != null} and ${userTicketPresent}">
						<div class="card mb-4">
							<h3>Titolo: </h3> <span th:text="${ticket.title}"> </span>
							<h3>Descrizione: </h3> <span th:text="${ticket.description}"> </span>
							<h3>Data ultima per chiusara: </h3> <span th:text="${ticket.endDate}"> </span>
							<h3>Stato Ticket: </h3> <span th:text="${ticket.statusTicket}"> </span>
							<h3>Ore lavorate: </h3> <span th:text="${ticket.timeWorked}"> </span>
							<h3>Categoria:</h3>
							<ul th:each="categories : ${ticket.categories}">
								<li th:text="${categories.name}"></li>
							</ul>
							<h3>Operatore: </h3>
							<ul th:each="user : ${ticket.user}">
								<li th:text="' Operatore: '+ ${user.name} + ' ' + ${user.surname} + ' email: ' + ${user.email}"></li>								
							</ul>
						</div>						
							<div sec:authorize="hasAuthority('ADMIN')">
								<h5>Modifica Ticket</h5>
								<a th:href="@{/tickets/editticket/{id} (id=${ticket.id})}" class="btn btn-primary mb-2">Modifica</a>
								<div>
									<form th:action="@{/tickets/delete/{id} (id=${ticket.id})}" method="post">
										<button class="btn btn-danger" type="submit"
											th:data-confirm-delete="|Sei sicuro di voler cancellare questa questo ticket e i suoi riferimenti associati?|"
											onclick="if(!confirm(this.getAttribute('data-confirm-delete')))return false">Delete</button>
									</form>
								</div> 
							</div>
							<div sec:authorize="hasAuthority('USER')">
								<h5>Aggiornamento Stato Ticket</h5>
								<a th:href="@{/tickets/editticket/{id} (id=${ticket.id})}" class="btn btn-primary mb-2">Aggiornamento</a>
							</div>
							
							<div>
								<h5>Aggiungi nota:</h5>
								<a 	 th:href="@{/tickets/addnote/{id} (id=${ticket.id})}"
									class="btn btn-primary mb-2">Aggiungi</a>
								<a th:href="@{/notes/ticket/{id} (id=${ticket.id})}" class="btn btn-primary mb-2">Tutte le note del Ticket</a>
							</div>
						</div>
					</div>
					<div class="col-12">
						<div th:if="${delete}">
							<h1>Hai cancellato il ticket</h1>
						</div>
					</div>
					 
					<div class="mt-3" th:unless="${userTicketPresent}">
						<h1>Questo ticket che cerchi ticket non esiste per te</h1>
					</div>					
				</div>
				
			</div>
		</div>
	</section>
	</main>
	
	<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}"></script>
	
</body>
	
</html>